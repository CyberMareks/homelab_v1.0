server:
    # --- Networking & Basics (Keep these) ---
    interface: 0.0.0.0
    port: 5335
    do-ip4: yes
    do-udp: yes
    do-tcp: yes
    root-hints: "/var/lib/unbound/root.hints"

    # --- Access Control (Keep these) ---
    access-control: 127.0.0.1/32 allow
    access-control: 192.168.20.0/24 allow
    access-control: 100.64.0.0/10 allow

    # --- Cache Sizes (Keep these) ---
    msg-cache-size: 128m
    rrset-cache-size: 256m
    msg-cache-slabs: 4
    rrset-cache-slabs: 4
    infra-cache-slabs: 4
    key-cache-slabs: 4

    # --- Longevity & Stale Data (Update these) ---
    cache-min-ttl: 300
    cache-max-ttl: 14400
    
    # NEW: RFC 8767 "Serve Stale" logic
    # This prevents the NXDOMAIN error when recursion is slow
    serve-expired: yes
    serve-expired-ttl: 86400 # Serve data up to 24h old if needed
    serve-expired-client-timeout: 1500 # If lookup > 1.5s, send old data

    # --- Performance Features (Keep/Update) ---
    prefetch: yes
    prefetch-key: yes
    aggressive-nsec: yes # Speeds up negative (NXDOMAIN) answers
    num-threads: 4 # Optimized for your Xeon E5-1650 v3
    so-rcvbuf: 4m # Prevents dropped packets during spikes
